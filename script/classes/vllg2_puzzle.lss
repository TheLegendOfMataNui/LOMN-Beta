class vllg2_puzzle {
    property parent;
    property oldplatform;
    property newplatform;
    property printwhichplatformimon;
    property puzinc;
    property currentlycollidingwith;
    property tempplatform;
    property canblow;
    property testplatforms;
    property testplatformsubound;
    property door2;
    property puzzlesolved;
    property deadhives;
    property savedrahi;
    property taskcomplete;
    property upgradefruit;
    property upgradefruit2;
    property upgradefruit_shown;
    property upgradefruit2_shown;
    property coindoor;
    property coindoortext1;
    property coindoortext2;
    property coindoortexttimer;
    property showcoindoor;
    property wirlpool;
    property orientation;
    property cinema;
    property cinema_shown;
    property shasa;
    property nixie;
    property maku;
    property keeper;
    property yia;
    property kai;
    property deori;
    property kailani;
    property nireta;
    property kotu;
    property hahli;
    property vhisola;
    property okoth;
    property marka;
    property pelagia;
    property aeryt;
    property xeleria;
    property certera;
    property gearactive;
    property diskactive;    
    property hutgear;
    
    method vllg2_puzzle(param1) {
        this.parent = param1;
        return null;
    }
    
    method initfull() {
        var var1;
        this.shasa = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vlgr"), 0);
        this.nixie = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl01"), 0);
        this.maku = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl02"), 0);
        this.keeper = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl03"), 0);
        this.yia = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl04"), 0);
        this.kai = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl05"), 0);
        this.deori = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl06"), 0);
        this.kailani = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl07"), 0);
        this.nireta = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl08"), 0);
        this.kotu = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl09"), 0);
        this.hahli = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl10"), 0);
        this.vhisola = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl11"), 0);
        this.okoth = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl12"), 0);
        this.marka = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl13"), 0);
        this.pelagia = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl14"), 0);
        this.aeryt = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl15"), 0);
        this.xeleria = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl16"), 0);
        this.certera = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl17"), 0);
        this.diskactive = 0;
        this.gearactive = 0;
        if (bettersaver::getbooleanvalue(36)) {              
            this.gearactive = 2;
        }
        this.hutgear = new lego_moveableobject("gea1");
        this.hutgear.initfull();
        this.hutgear.hide();
        gcmodeldirector::setnearestmax(7);
        gcareadirector::setnearestmax(8);
        gcareadirector::setfog(-9143565, 0 - 1000.0, 0 - 50000.0, 0.01);
        gclightdirector::setcavelighting(0);
        if (gcsaver::findcinema(scslosifoundation::stringtoidentifier("cin3"))) {
            this.cinema_shown = 1;
        }
        else {
            this.cinema_shown = 0;
        }	
        if (this.cinema_shown == 0) {
            this.cinema = gccinemaengine::create();
            gccinemaengine::load(this.cinema, "cin3");
            gccinemaengine::setnextarea(this.cinema, scslosifoundation::stringtoidentifier("tura"));
        }
        this.puzzlesolved = 0;
        this.coindoor = new lego_moveableobject("drs0", "vllg");
        this.coindoor.initfull();
        if (bettersaver::getbooleanvalue(53) == 0) {
            this.showcoindoor = 1;
            this.coindoor.show();
            this.coindoor.setalpha(0.5);
        }
        else {
            this.coindoor.hide();
        }

        //Set Door Text
        this.coindoortext1 = new gs_legotext("Root/Data/Art/Fonts/BionicleFontHi", gcareadirector::getscriptfluffstring(scslosifoundation::stringtoidentifier("door"), 1, 0) +  gcareadirector::getscriptfluffstring(scslosifoundation::stringtoidentifier("door"), 1, 2), screenx * 0.5, screeny * 0.70, 0, 1.5, 256, 4, 0);
        this.coindoortext2 = new gs_legotext("Root/Data/Art/Fonts/BionicleFontHi", "14 " + gcareadirector::getscriptfluffstring(scslosifoundation::stringtoidentifier("door"), 1, 4), screenx * 0.5, screeny * 0.75, 0, 1.5, 256, 4, 0);
        this.coindoortext1.initfull();
        this.coindoortext2.initfull();
        this.coindoortext1.add();
        this.coindoortext2.add();
        this.coindoortexttimer = 0.0;

        this.door2 = new lego_moveableobject("drs1");
        this.door2.initfull();
        gccharactermoveinterpreter::checkanimdone(scslosifoundation::stringtoidentifier("g054"));
        this.testplatforms = [ new lego_moveableobject("pl01"), 
            new lego_moveableobject("pl02"), 
            new lego_moveableobject("pl03"), 
            new lego_moveableobject("pl04") ];
        var1 = 0;
        while ((this.testplatforms.__length - 1) >= var1) {
            this.testplatforms[var1].initfull();
            this.testplatforms[var1].settweakable();
            this.testplatforms[var1].setresponse(0, 0, 0);
            this.testplatforms[var1].movebboxsides(1.7, 1.7, 1.7, 0 - 1.7, 0 - 1.7, 0 - 1.7);
            var1 = var1 + 1;
        }
        this.testplatformsubound = this.testplatforms.__length - 1;
        this.puzinc = 1;
        this.canblow = 0;
        this.tempplatform = this.testplatforms[0];
        this.tempplatform.collide = 0;
        this.deadhives = 0;
        this.savedrahi = 0;
        this.taskcomplete = 0;
        if (gcsaver::isconditionset(1073741824)) {
            //Set Tohunga: Shasa (VLGR)
            gccharacter::settohunga(this.shasa, rgba(0, 0, 255, 255), rgba(0, 0, 255, 255), scslosifoundation::stringtoidentifier("mkba"));
			gccharacter::setorientation(this.shasa, 270);
            gccharacter::setinputstate(this.shasa, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.shasa, scslosifoundation::stringtoidentifier("d003"), -1);
            if (bettersaver::getbooleanvalue(35) == 1) {
                //Set to idle & add item              
                gccharacter::switchanimation(this.shasa, scslosifoundation::stringtoidentifier("d000"), -1);
                if (this.diskactive == 0) {
                    gccharacter::addpart(this.shasa, "vlgr/sash", 1);
                    this.diskactive = 1;
                }
            }
            
            //Set Tohunga Nixie (VL01)
            gccharacter::settohunga(this.nixie, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk0a"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl01"), 0), rgba(0, 60, 91, 255), rgba(72, 117, 174, 255), rgba(0, 0, 255, 255));
            gccharacter::setorientation(this.nixie, -2);
            gccharacter::setinputstate(this.nixie, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.nixie, scslosifoundation::stringtoidentifier("d003"), -1);
            if (bettersaver::getbooleanvalue(36) == 1) {
                //Set to idle & place item              
                gccharacter::switchanimation(this.nixie, scslosifoundation::stringtoidentifier("d000"), -1);
                if (this.gearactive == 2) {
                    this.hutgear.show();
                }
            }
           
            //Set Tohunga: Maku (VL02)
            gccharacter::settohunga(this.maku, rgba(0, 0, 255, 255), rgba(0, 0, 255, 255), scslosifoundation::stringtoidentifier("mk7a"));
            gccharacter::setorientation(this.maku, -70);
            gccharacter::setinputstate(this.maku, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.maku, scslosifoundation::stringtoidentifier("d000"), -1);
            
            //Set Tohunga: Treekeeper (VL03)
            gccharacter::settohunga(this.keeper, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk4a"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl03"), 0), rgba(0, 208, 33, 255), rgba(0, 208, 33, 255), rgba(102, 0, 102, 255));
            gccharacter::setorientation(this.keeper, 10);
            gccharacter::setinputstate(this.keeper, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.keeper, scslosifoundation::stringtoidentifier("d000"), -1);
            
            //Set Tohunga: Yia (VL04)
            gccharacter::settohunga(this.yia, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk9a"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl04"), 0), rgba(0, 0, 255, 255), rgba(0, 0, 255, 255), rgba(39, 38, 39, 255));
            gccharacter::setorientation(this.yia, 158);
            gccharacter::setinputstate(this.yia, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.yia, scslosifoundation::stringtoidentifier("d000"), -1);
            gccharacter::addpart(this.yia, "vl04/sash", 1);
            gccharacter::addpart(this.yia, "vl04/staf", 2);
            
            //Set Tohunga: Kai (VL05)
            gccharacter::settohunga(this.kai, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk2a"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl05"), 0), rgba(0, 0, 255, 255), rgba(0, 0, 255, 255), rgba(0, 0, 255, 255));
            gccharacter::setorientation(this.kai, 149);
            gccharacter::setinputstate(this.kai, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.kai, scslosifoundation::stringtoidentifier("d000"), -1);
            gccharacter::addpart(this.kai, "vl05/sash", 1);
            gccharacter::addpart(this.kai, "vl05/staf", 2);
            
            //Set Tohunga: Deori (VL06)
            gccharacter::settohunga(this.deori, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mkca"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl06"), 0), rgba(72, 117, 174, 255), rgba(72, 117, 174, 255), rgba(0, 60, 91, 255));
            gccharacter::setorientation(this.deori, 44);
            gccharacter::setinputstate(this.deori, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.deori, scslosifoundation::stringtoidentifier("d000"), -1);
            gccharacter::addpart(this.deori, "vl06/sash", 1);
            gccharacter::addpart(this.deori, "vl06/staf", 2);
            
            //Set Tohunga: Kailani (VL07)
            gccharacter::settohunga(this.kailani, rgba(72, 117, 174, 255), rgba(72, 117, 174, 255), scslosifoundation::stringtoidentifier("mk8a"));
            
            //Set Tohunga: Nireta (VL08)
            gccharacter::settohunga(this.nireta, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk2a"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl08"), 0), rgba(72, 117, 174, 255), rgba(72, 117, 174, 255), rgba(0, 0, 255, 255));
            
			//Set Rahi: Blue Turtle
			gcmodeldirector::show(scslosifoundation::stringtoidentifier("btrt"), 0);
			
            //Set Tohunga: Kotu (VL09)
            gccharacter::settohunga(this.kotu, rgba(0, 0, 255, 255), rgba(0, 0, 255, 255), scslosifoundation::stringtoidentifier("mk9a"));
            gccharacter::setorientation(this.kotu, 174);
            gccharacter::setinputstate(this.kotu, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.kotu, scslosifoundation::stringtoidentifier("hak4"), -1);
            
            //Set Tohunga: Hahli (VL10)
            gccharacter::settohunga(this.hahli, rgba(0, 60, 91, 255), rgba(0, 0, 255, 255), scslosifoundation::stringtoidentifier("mk1a"));
            gccharacter::setorientation(this.hahli, 60);
            gccharacter::setinputstate(this.hahli, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.hahli, scslosifoundation::stringtoidentifier("hak4"), -1);
            
            //Set Tohunga: Vhisola (VL11)
            gccharacter::settohunga(this.vhisola, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mkaa"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl11"), 0), rgba(0, 0, 255, 255), rgba(0, 0, 255, 255), rgba(115, 117, 115, 255));
            gccharacter::setorientation(this.vhisola, 6);
            gccharacter::setinputstate(this.vhisola, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.vhisola, scslosifoundation::stringtoidentifier("hak4"), -1);
            
            //Set Tohunga: Okoth (VL12)
            gccharacter::settohunga(this.okoth, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk4a"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl12"), 0), rgba(72, 117, 174, 255), rgba(0, 60, 91, 255), rgba(0, 0, 255, 255));
            
            //Set Tohunga: Marka (VL13)
            gccharacter::settohunga(this.marka, rgba(0, 60, 91, 255), rgba(0, 60, 91, 255), scslosifoundation::stringtoidentifier("mk6a"));
            gccharacter::setorientation(this.marka, 22);
            gccharacter::setinputstate(this.marka, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.marka, scslosifoundation::stringtoidentifier("d000"), -1);
            
            //Set Tohunga: Pelagia (VL14)
            gccharacter::settohunga(this.pelagia, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk3a"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl14"), 0), rgba(0, 60, 91, 255), rgba(0, 60, 91, 255), rgba(0, 60, 91, 255));
            
            //Set Tohunga: Aeryt (Vl15)
            gccharacter::settohunga(this.aeryt, rgba(0, 60, 91, 255), rgba(0, 0, 255, 255), scslosifoundation::stringtoidentifier("mkaa"));
            
            //Set Tohunga: Xeleria (VL16)
            gccharacter::settohunga(this.xeleria, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk1a"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl16"), 0), rgba(0, 60, 91, 255), rgba(0, 60, 91, 255), rgba(0, 60, 91, 255));
            gccharacter::setorientation(this.xeleria, 174);
            gccharacter::setinputstate(this.xeleria, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.xeleria, scslosifoundation::stringtoidentifier("d000"), -1);
            gccharacter::addpart(this.xeleria, "vl16/sash", 1);
            gccharacter::addpart(this.xeleria, "vl16/staf", 2);
            
            //Set Tohunga: Certera (VL17)
            gccharacter::settohunga(this.certera, rgba(0, 0, 255, 255), rgba(0, 0, 255, 255), scslosifoundation::stringtoidentifier("mk9a"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl17"), 0), rgba(72, 117, 174, 255), rgba(72, 117, 174, 255), rgba(0, 0, 255, 255));

            //Hiding hives & Turaga door
            gcareadirector::hide(scslosifoundation::stringtoidentifier("dor2"), scslosifoundation::stringtoidentifier("vllg"));
            gcareadirector::hide(scslosifoundation::stringtoidentifier("ghv0"), scslosifoundation::stringtoidentifier("vllg"));
            gcareadirector::hide(scslosifoundation::stringtoidentifier("ghv1"), scslosifoundation::stringtoidentifier("vllg"));
            gcareadirector::hide(scslosifoundation::stringtoidentifier("fhv0"), scslosifoundation::stringtoidentifier("vllg"));
            gcareadirector::hide(scslosifoundation::stringtoidentifier("fhv1"), scslosifoundation::stringtoidentifier("vllg"));
            globalclass.bgmusic.changefilename("Root/Data/sounds/MusicVillage");
            globalclass.bgmusic.play(1);
        }
        else {
            //Hiding Characters
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vlgr"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl01"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl02"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl03"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl04"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl05"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl06"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl07"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl08"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl09"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl10"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl11"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl12"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl13"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl14"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl15"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl16"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl17"), 0);
			gcmodeldirector::hide(scslosifoundation::stringtoidentifier("btrt"), 0);
            globalclass.bgmusic.changefilename("Root/Data/sounds/Musicgalitheme");
            globalclass.bgmusic.play();
        }
        this.upgradefruit_shown = gcsaver::finditem(scslosifoundation::stringtoidentifier("frut"));
        if (this.upgradefruit_shown == 0) {
            this.upgradefruit = new lego_pickup("frut", 0, 6, "frut", 1, 1);
            this.upgradefruit.initfull();
        }
        this.upgradefruit2_shown = gcsaver::finditem(scslosifoundation::stringtoidentifier("fru0"));
        if (this.upgradefruit2_shown == 0) {
            this.upgradefruit2 = new lego_pickup("fru0", 0, 6, "frut", 1, 1);
            this.upgradefruit2.initfull();
        }
        if (bettersaver::getbooleanvalue(59) == 1) {
            gccollisionphysicsgroup::togglepickuponoff(scslosifoundation::stringtoidentifier("ar00"), 0);
            gcnolightdirector::hide(scslosifoundation::stringtoidentifier("ar00"), gcareadirector::getcurrentarea());
        }
        this.wirlpool = new lego_moveableobject("vtcr");
        this.wirlpool.initfull();
        this.wirlpool.settweakable();
        this.orientation = 1;
        return null;
    }
    
    method cleanupfull() {
        var var1;
        this.oldplatform = null;
        this.newplatform = null;
        this.puzinc = null;
        this.currentlycollidingwith = null;
        this.tempplatform = null;
        if (this.testplatforms != null) {
            var1 = 0;
            while ((this.testplatforms.__length - 1) >= var1) {
                this.testplatforms[var1].cleanupfull();
                this.testplatforms[var1] = null;
                var1 = var1 + 1;
            }
            this.testplatforms = null;
        }
        if (this.upgradefruit != null) {
            this.upgradefruit.cleanupfull();
            this.upgradefruit = null;
        }
        if (this.upgradefruit2 != null) {
            this.upgradefruit2.cleanupfull();
            this.upgradefruit2 = null;
        }
        if (this.coindoortext1 != null) {
            this.coindoortext1.remove();
            this.coindoortext1.cleanupfull();
            this.coindoortext1 = null;
        }
        if (this.coindoortext2 != null) {
            this.coindoortext2.remove();
            this.coindoortext2.cleanupfull();
            this.coindoortext2 = null;
        }
        if (this.coindoor != null) {
            this.coindoor.cleanupfull();
            this.coindoor = null;
        }
        if (this.wirlpool != null) {
            this.wirlpool.cleanupfull();
            this.wirlpool = null;
        }
        this.cinema = null;
        this.shasa = null;
        this.nixie = null;
        this.maku = null;
        this.keeper = null;
        this.yia = null;
        this.kai = null;
        this.deori = null;
        this.kailani = null;
        this.nireta = null;
        this.kotu = null;
        this.hahli = null;
        this.vhisola = null;
        this.okoth = null;
        this.marka = null;
        this.pelagia = null;
        this.aeryt = null;
        this.xeleria = null;
        this.certera = null;
        this.gearactive = null;
        this.diskactive = null;
        this.hutgear = null;
        return null;
    }
    
    method process(param1) {
        var var1;
        var1 = 0;
        this.rotatecrystal();
        while (this.testplatformsubound >= var1) {
            this.testplatforms[var1].process();
            var1 = var1 + 1;
        }
        this.tempplatform.process();
        if (this.tempplatform.collide == 0) {
            this.canblow = 0;
        }
        if (this.coindoortexttimer > 0) {
            this.coindoortexttimer = this.coindoortexttimer - param1.deltatime;
        }
        else if (this.coindoortext1.onscreen == 1) {
            this.coindoortext1.hide();
            this.coindoortext2.hide();
        }
        return null;
    }
    
    method onevent(param1) {
        if (param1.eventid == 51) {
            this.deadhives = this.deadhives + 1;
        }
        else if (param1.eventid == 101) {
            this.savedrahi = this.savedrahi + 1;
        }        
        else if (param1.eventid == 44) {
            if ((this.deadhives == 4) && (this.savedrahi == 4) && (this.taskcomplete == 0)) {
                gcsaver::setcondition(1073741824, 1);
                gcareadirector::hide(scslosifoundation::stringtoidentifier("dor2"), scslosifoundation::stringtoidentifier("vllg"));
                globalclass.bgmusic.stop();
                this.taskcomplete = 1;
            }
        }
        else if (param1.eventid == 4) {
            if ((param1.args[0] == scslosifoundation::stringtoidentifier("cin3")) && (this.cinema_shown == 0)) {
                if (((gcsaver::isconditionset(1) && gcsaver::isconditionset(2)) && gcsaver::isconditionset(4)) && gcsaver::isconditionset(8)) {
                    globalclass.player.actor.deactivatedragger();
                    if (globalclass.player.actor.isdraggeractive() == 0) {
                        gccinemaengine::play(this.cinema);
                        //Remove Tohunga hand items
                        if (this.gearactive == 1) {
                            gccharacter::removepart(this.nixie, 1);
                        }
                        gccharacter::removepart(this.yia, 2);
                        gccharacter::removepart(this.kai, 2);
                        gccharacter::removepart(this.deori, 2);
                        gccharacter::removepart(this.xeleria, 2);
                        this.cinema_shown = 1;
                        if (globalclass.player.maskcontrol.isactive()) {
                            globalclass.player.maskcontrol.toggleactive();
                            globalclass.hud.mask.hide();
                        }
                    }
                }
            }
        }
        else if (param1.eventid == 8) {
		    if (param1.args[0] == scslosifoundation::stringtoidentifier("dspt")) {
			    if (this.desctext != null) {
				    this.desctext.hide();
				    this.desctext.cleanupfull();
				    this.desctext = null;
			    }
			    if (this.howtotext != null) {
				    this.howtotext.hide();
				    this.howtotext.cleanupfull();
				    this.howtotext = null;
			    }
		    }
        }
        else if (param1.eventid == 35) {
            if (param1.args[0] == scslosifoundation::stringtoidentifier("drs0")) {
                bettersaver::setbooleanvalue(53, 1);
                this.coindoor.hide();
            }
        }
        else if (param1.eventid == 1) {
            if (param1.args[0] == scslosifoundation::stringtoidentifier("cnt1")) {
                if (param1.args[1] != scslosifoundation::stringtoidentifier("cnt1")) {
                    this.newplatform = param1.args[1];
                    if (this.oldplatform != this.newplatform) {
                        this.printwhichplatformimon = 1;
                    }
                    if (this.printwhichplatformimon) {
                        debug::print("You're on platform " + scslosifoundation::identifiertostring(param1.args[1]));
                        this.oldplatform = param1.args[1];
                        this.printwhichplatformimon = 0;
                    }
                }
            }
            if (param1.args[2] == 0) {
                if (param1.args[0] == scslosifoundation::stringtoidentifier("cnt1")) {
                    if (param1.args[1] == this.testplatforms[0].id) {
                        this.currentlycollidingwith = this.testplatforms[0].id;
                        this.tempplatform = this.testplatforms[0];
                        this.canblow = 1;
                        this.tempplatform.setcollide();
                    }
                    else if (param1.args[1] == this.testplatforms[1].id) {
                        this.currentlycollidingwith = this.testplatforms[1].id;
                        this.tempplatform = this.testplatforms[1];
                        this.canblow = 1;
                        this.tempplatform.setcollide();
                    }
                    else if (param1.args[1] == this.testplatforms[2].id) {
                        this.currentlycollidingwith = this.testplatforms[2].id;
                        this.tempplatform = this.testplatforms[2];
                        this.canblow = 1;
                        this.tempplatform.setcollide();
                    }
                    else if (param1.args[1] == this.testplatforms[3].id) {
                        this.currentlycollidingwith = this.testplatforms[3].id;
                        this.tempplatform = this.testplatforms[3];
                        this.canblow = 1;
                        this.tempplatform.setcollide();
                    }
                }
            }
            if (param1.args[1] == scslosifoundation::stringtoidentifier("drs0")) {
                if (this.showcoindoor == 1) {
                    if ((globalclass.player.tokens >= 14) && (globalclass.player.maskcontrol.isselectable(9)) && (globalclass.player.actor.ishookenabled) && (gcsaver::isconditionset(1073741824))) {
                        this.coindoor.fadeout(1.5);
                        gcstaticsoundsptrarray::playtablesound(1084);
                        this.showcoindoor = 0;
                        this.coindoortext1.hide();
                        this.coindoortext2.hide();
                    }
                    else {
                        this.coindoortext1.show();
                        this.coindoortext2.show();
                        this.coindoortexttimer = 1.0;
                    }
                }
            }

        }
        else if (param1.eventid == 11) {
            if (scslosifoundation::identifiertostring(param1.args[1]) == "g054") {
                debug::print("***** GETTING THE ANIM_FINISHED EVENT FOR go54");
                globalclass.player.actor.setinputstate("ninp");
                globalclass.level.cam.setaimode(11);
                if (this.puzzlesolved) {
                    this.opendoortoevac();
                    this.puzzlesolved = 0;
                }
            }
        }
        else if (param1.eventid == 27) {
            globalclass.player.unkill();
            globalclass.player.actor.gotopos(this.parent.enterstartid, this.parent.enterlookid);
            globalclass.player.actor.switchanimation(scslosifoundation::stringtoidentifier("g000"));
            this.parent.level.cam.setaimode(11);
        }
        else if (param1.eventid == 12) {
            if (param1.args[0] == scslosifoundation::stringtoidentifier("drs1")) {
                globalclass.player.actor.setinputstate("ninp");
                globalclass.level.cam.setaimode(11);
            }
        }
        else if (param1.eventid == 41) {
            if (bettersaver::getbooleanvalue(35)) {
                //Shasa Quest Complete    
                if (this.upgradefruit_shown == 0) {
                    this.upgradefruit.obj.setpos(68.00262, 37.4, 58.24104);
                    gcstaticsoundsptrarray::playtablesound(1032);
                    this.upgradefruit_shown = 1;
                }
                if (this.diskactive == 0) {
                    gccharacter::addpart(this.shasa, "vlgr/sash", 1);
                    this.diskactive = 1; 
                }
            }
            if (bettersaver::getbooleanvalue(36)) {
                //Nixie Quest Complete    
                if (this.upgradefruit2_shown == 0) {
                    this.upgradefruit2.obj.setpos(461.1303, 35.8, 473.2127);
                    gcstaticsoundsptrarray::playtablesound(1032);
                    this.upgradefruit2_shown = 1;
                }
                if (this.gearactive == 0) {               
                    gccharacter::addpart(this.nixie, "vl01/gear", 1);
                    this.gearactive = 1;        
                }
            }
        }
        else if (param1.eventid == 8) {
            if (param1.args[0] == scslosifoundation::stringtoidentifier("dspt")) {
                if (this.desctext != null) {
                    this.desctext.hide();
                    this.desctext.cleanupfull();
                    this.desctext = null;
                }
                if (this.howtotext != null) {
                    this.howtotext.hide();
                    this.howtotext.cleanupfull();
                    this.howtotext = null;
                }
            }
        }
        return null;
    }
    
    method input(param1) {
        if (param1.button == 90) {
            if (param1.event == 2) {
                this.cheat(1);
            }
        }
        if (param1.button == 231) {
            if (param1.event == 2) {
                this.blowtheconch();
            }
        }
        if (param1.button == 88) {
            if (param1.event == 2) {
                this.cheat(2);
            }
        }
        if (param1.button == 67) {
            if (param1.event == 2) {
                this.cheat(3);
            }
        }
        if (param1.event == 2) { 
            if (param1.button == 251) {
                if (this.cinema != null) {
                    gccinemaengine::stop(this.cinema);
                }
            }
        }
        return null;
    }
    
    method exit() {
        this.parent = null;
        return null;
    }

    method cheat(param1) {
        if (param1 == 1) {
            globalclass.player.addtoken(1);
        }
        else if (param1 == 2) {
            globalclass.player.actor.setpos(0 - 0.4, 88.2, 0 - 52.0);
        }
        else if (param1 == 3) {
            this.opendoortoevac();
        }
        return null;
    }
    
    method blowtheconch() {
        var var1;
        var var2;
        var var3;
        if (this.canblow) {
            if ((globalclass.player.actor.getorientation() > -45) && (globalclass.player.actor.getorientation() < 45)) {
                globalclass.player.actor.setorientation(-1);
                if (this.currentlycollidingwith == this.testplatforms[0].id) {
                    debug::print("******* BLOWING CONCH 1");
                    var1 = this.testplatforms[0].getx();
                    var2 = this.testplatforms[0].gety();
                    var3 = this.testplatforms[0].getz();
                    gcstaticsoundsptrarray::playtablesound(1044);
                    globalclass.player.actor.setpos(var1, var2, var3);
                    globalclass.player.actor.setinputstate("none");
                    globalclass.player.actor.setsplitanimation(scslosifoundation::stringtoidentifier("g054"));
                    if (this.puzinc < 8) {
                        if ((this.puzinc == 1) || (this.puzinc == 6)) {
                            this.puzinc = this.puzinc + 1;
                        }
                        else {
                            this.puzinc = 1;
                        }
                    }
                }
                else if (this.currentlycollidingwith == this.testplatforms[1].id) {
                    debug::print("******* BLOWING CONCH 2");
                    var1 = this.testplatforms[1].getx();
                    var2 = this.testplatforms[1].gety();
                    var3 = this.testplatforms[1].getz();
                    gcstaticsoundsptrarray::playtablesound(1045);
                    globalclass.player.actor.setpos(var1, var2, var3);
                    globalclass.player.actor.setinputstate("none");
                    globalclass.player.actor.setsplitanimation(scslosifoundation::stringtoidentifier("g054"));
                    if (this.puzinc < 8) {
                        if (this.puzinc == 4) {
                            this.puzinc = this.puzinc + 1;
                        }
                        else {
                            this.puzinc = 1;
                        }
                    }
                }
                else if (this.currentlycollidingwith == this.testplatforms[2].id) {
                    debug::print("******* BLOWING CONCH 3");
                    var1 = this.testplatforms[2].getx();
                    var2 = this.testplatforms[2].gety();
                    var3 = this.testplatforms[2].getz();
                    gcstaticsoundsptrarray::playtablesound(1046);
                    globalclass.player.actor.setpos(var1, var2, var3);
                    globalclass.player.actor.setinputstate("none");
                    globalclass.player.actor.setsplitanimation(scslosifoundation::stringtoidentifier("g054"));
                    if (this.puzinc < 8) {
                        if ((this.puzinc == 2) || (this.puzinc == 7)) {
                            if (this.puzinc == 7) {
                                debug::print("************** CONGRATS PUZZLE SOLVED");
                                this.puzzlesolved = 1;
                            }
                            this.puzinc = this.puzinc + 1;
                        }
                        else {
                            this.puzinc = 1;
                        }
                    }
                }
                else if (this.currentlycollidingwith == this.testplatforms[3].id) {
                    debug::print("******* BLOWING CONCH 4");
                    var1 = this.testplatforms[3].getx();
                    var2 = this.testplatforms[3].gety();
                    var3 = this.testplatforms[3].getz();
                    gcstaticsoundsptrarray::playtablesound(1047);
                    globalclass.player.actor.setpos(var1, var2, var3);
                    globalclass.player.actor.setinputstate("none");
                    globalclass.player.actor.setsplitanimation(scslosifoundation::stringtoidentifier("g054"));
                    if (this.puzinc < 8) {
                        if ((this.puzinc == 3) || (this.puzinc == 5)) {
                            this.puzinc = this.puzinc + 1;
                        }
                        else {
                            this.puzinc = 1;
                        }
                    }
                }
            }
            else {
                debug::print("you are not within the orientation range limit....");
            }
        }
        return null;
    }
    
    method opendoortoevac() {
        var var1;
        var var2;
        var var3;
        var1 = this.door2.getx();
        var2 = this.door2.gety();
        var3 = this.door2.getz();
        globalclass.level.cam.setaimode(0);
        globalclass.level.cam.setpos(0 - 3.6, 96.4, 0 - 110.6);
        globalclass.level.cam.settargetpos(var1, var2, var3);
        globalclass.level.cam.shakecamera(2.45, 0.5);
        globalclass.player.actor.setinputstate("none");
        this.door2.interpolate(var1, var2 + 9.5, var3, 2.5);
        return null;
    }

    method rotatecrystal() {
        if (this.orientation > 359) {
            this.orientation = 0;
        }
        else {
            this.orientation = this.orientation + 1;
        }
        this.wirlpool.setorientation(0.0, this.orientation, 0.0);
        return null;
    }
}