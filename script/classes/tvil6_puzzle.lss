class tvil6_puzzle {
    property parent;
    property upgradefruit;
    property upgradefruit_shown;
    property platform1;
    property platform2;
    property platform3;
    property platform4;
    property platform5;
    property bridgeState;
    property kalama;
    property lever;
    
    method tvil6_puzzle(param1) {
        this.parent = param1;
        return null;
    }
    
    method initfull() {
        var bridge_operator;
        this.kalama = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vlgr"), 0);
        this.lever = new lego_moveableobject("levr");
        this.lever.initfull();       
        gcmodeldirector::setnearestmax(15);
        gcareadirector::setnearestmax(15);
        gcareadirector::setfog(-4513246, 0 - 1.0, 0 - 900.0, 0.05);
        globalclass.bgmusic.changefilename("Root/Data/sounds/MusicPart2LegoUNDERGROUND");
        globalclass.bgmusic.play(1);

        //Set Tohunga: Kalama        
        gccharacter::settohunga(this.kalama, rgba(41, 41, 41, 255), rgba(41, 41, 41, 255), scslosifoundation::stringtoidentifier("mkba"));
        gccharacter::setinputstate(this.kalama, scslosifoundation::stringtoidentifier("none"));
        gccharacter::switchanimation(this.kalama, scslosifoundation::stringtoidentifier("d003"), -1);
        gccharacter::setorientation(this.kalama, -46);
        if (bettersaver::getbooleanvalue(47) == 1) {            
            gccharacter::switchanimation(this.kalama, scslosifoundation::stringtoidentifier("d000"), -1);
        }
        this.lever.hide();
        this.upgradefruit_shown = gcsaver::finditem(scslosifoundation::stringtoidentifier("frut"));
        if (this.upgradefruit_shown == 0) {
            this.upgradefruit = new lego_pickup("frut", 0, 6, "frut", 1, 1);
            this.upgradefruit.initfull();
        }
        this.platform1 = new lego_moveableobject("prt1");
        this.platform1.initfull();
        this.platform1.settweakable();
        this.platform2 = new lego_moveableobject("prt2");
        this.platform2.initfull();
        this.platform2.settweakable();
        this.platform3 = new lego_moveableobject("prt3");
        this.platform3.initfull();
        this.platform3.settweakable();
        this.platform4 = new lego_moveableobject("prt4");
        this.platform4.initfull();
        this.platform4.settweakable();
        this.platform5 = new lego_moveableobject("prt5");
        this.platform5.initfull();
        this.platform5.settweakable();
        this.bridgeState = 0;
        if (bettersaver::getbooleanvalue(64) == 1) {
            this.platform1.interpolate(-114.491, -71.3708, 390.263, 0.0);
            this.platform2.interpolate(-125.478, -71.3708, 361.763, 0.0);
            this.platform3.interpolate(-134.103, -71.3708, 333.000, 0.0);
            this.platform4.interpolate(-123.733, -71.3708, 302.963, 0.0);
            this.platform5.interpolate(-111.871, -71.3708, 274.763, 0.0);
            this.bridgeState = 1;
            this.lever.show();
        }
        return null;
    }
    
    method cleanupfull() {
        if (this.upgradefruit != null) {
            this.upgradefruit.cleanupfull();
            this.upgradefruit = null;
        }
        if (this.platform1 != null) {
            this.platform1.cleanupfull();
            this.platform1 = null;
        }
        if (this.platform2 != null) {
            this.platform2.cleanupfull();
            this.platform2 = null;
        }
        if (this.platform3 != null) {
            this.platform3.cleanupfull();
            this.platform3 = null;
        }
        if (this.platform4 != null) {
            this.platform4.cleanupfull();
            this.platform4 = null;
        }
        if (this.platform5 != null) {
            this.platform5.cleanupfull();
            this.platform5 = null;
        }
        this.kalama = null;
        this.lever = null;
        return null;
    }
    
    method exit() {
        this.parent = null;
        return null;
    }
    
    method process(param1) {
        return null;
    }
    
    method onevent(param1) {
        if (param1.eventid == 1) {
            if (param1.args[1] == scslosifoundation::stringtoidentifier("cnt1")) {
                
            }
        }
        else if (param1.eventid == 27) {
            globalclass.player.actor.gotopos(this.parent.enterstartid, this.parent.enterlookid);
            globalclass.player.unkill();
            globalclass.player.actor.setinputstate("ninp");
        }
        else if (param1.eventid == 41) {
            if (bettersaver::getbooleanvalue(47)) {
                //Kalama Quest Complete
                if (this.upgradefruit_shown == 0) {
                    this.upgradefruit.obj.setpos(-116.2455, -7.307096, 438.8899);
                    gcstaticsoundsptrarray::playtablesound(1032);
                    this.upgradefruit_shown = 1;
                }
                if (this.bridgeState == 0) {
                    this.platform1.interpolate(-114.491, -71.3708, 390.263, 6.0);
                    this.platform2.interpolate(-125.478, -71.3708, 361.763, 7.0);
                    this.platform3.interpolate(-134.103, -71.3708, 333.000, 8.0);
                    this.platform4.interpolate(-123.733, -71.3708, 302.963, 9.0);
                    this.platform5.interpolate(-111.871, -71.3708, 274.763, 10.0);
                    bettersaver::setbooleanvalue(64, 1);
                    this.bridgeState = 1;
                    this.lever.show();
                }
            }
        }
        return null;
    }
    
    method input(param1) {
        return null;
    }
}