class vllg6_puzzle {
    property parent;
    property deadhives;
    property savedrahi;
    property taskcomplete;
    property swrd;
    property upgradefruit2;
    property upgradefruit3;
    property upgradefruit2_shown;
    property upgradefruit3_shown;
    property wirlpool;
    property orientation;
    property kapura;
    property keahi;
    property vohon;
    property nuri;
    property agni;
    property tiribomba;
    property aodhan;
    property aft;
    property maglya;
    property jala;
    property keeper;
    property nganiki;
    property klatuu;
    property poiri;
    property penpuku;
    property giegue;
    property saumana;
    property joel;
    property boardactive;
    property diskactive;
    property hutboard;
    property board;
   
    method vllg6_puzzle(param1) {
        this.parent = param1;
        return null;
    }
    
    method initfull() {
        gcmodeldirector::setnearestmax(7);
        gcareadirector::setnearestmax(20);
        gcareadirector::setfog(-4513246, 0 - 1.0, 0 - 900.0, 0.05);
        this.kapura = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vlgr"), 0);
        this.keahi = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl01"), 0);
        this.vohon = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl02"), 0);
        this.nuri = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl03"), 0);
        this.agni = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl04"), 0);
        this.tiribomba = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl05"), 0);
        this.aodhan = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl06"), 0);
        this.aft = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl07"), 0);
        this.maglya = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl08"), 0);
        this.jala = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl09"), 0);
        this.keeper = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl10"), 0);
        this.nganiki = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl11"), 0);
        this.klatuu = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl12"), 0);
        this.poiri = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl13"), 0);
        this.penpuku = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl14"), 0);
        this.giegue = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl15"), 0);
        this.saumana = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl16"), 0);
        this.joel = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl17"), 0);
        this.diskactive = 0;
        this.boardactive = 0;
        if (bettersaver::getbooleanvalue(49)) {              
            this.boardactive = 2;
        }
        this.hutboard = new lego_moveableobject("sld1");
        this.hutboard.initfull();
        this.hutboard.hide();
        this.board = new lego_moveableobject("sled");
        this.board.initfull();
        this.board.hide();
        if (gcsaver::finditem(scslosifoundation::stringtoidentifier("swrd")) == 0) {
            this.swrd = new lego_pickup("swrd", 0, 3, "item", 9, 1);
            this.swrd.initfull();
            this.swrd.show();
        }
        else {
            this.swrd = new lego_moveableobject("swrd");
            this.swrd.initfull();
            this.swrd.hide();
        }
        this.deadhives = 0;
        this.savedrahi = 0;
        this.taskcomplete = 0;
        if (gcsaver::isconditionset(1073741824)) {
            globalclass.player.processequipment(2);       
            //Set Kapura (VLGR)
            gccharacter::setkapura(this.kapura);
            
            //Set Tohunga: Keahi (VL01)
            gccharacter::settohunga(this.keahi, rgba(255, 247, 0, 255), rgba(255, 247, 0, 255), scslosifoundation::stringtoidentifier("mk9a"));
            gccharacter::setorientation(this.keahi, -108);
            gccharacter::setinputstate(this.keahi, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.keahi, scslosifoundation::stringtoidentifier("hak6"), -1);
            
            //Set Tohunga: Vohon (VL02)
            gccharacter::settohunga(this.vohon, rgba(255, 247, 0, 255), rgba(255, 247, 0, 255), scslosifoundation::stringtoidentifier("mk2a"));
            
            //Set Tohunga: Nuri (VL03)
            gccharacter::settohunga(this.nuri, rgba(39, 39, 39, 255), rgba(39, 39, 39, 255), scslosifoundation::stringtoidentifier("mk1a"));
            gccharacter::setorientation(this.nuri, 112);
            gccharacter::setinputstate(this.nuri, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.nuri, scslosifoundation::stringtoidentifier("hak6"), -1);
            
            //Set Tohunga: Agni (VL04)
            gccharacter::settohunga(this.agni, rgba(255, 0, 13, 255), rgba(255, 0, 13, 255), scslosifoundation::stringtoidentifier("mk4a"));
            gccharacter::setinputstate(this.agni, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.agni, scslosifoundation::stringtoidentifier("d003"), -1);
            gccharacter::setorientation(this.agni, -49);
            if (bettersaver::getbooleanvalue(48) == 1) {
                //Set to idle & add item              
                gccharacter::switchanimation(this.agni, scslosifoundation::stringtoidentifier("d000"), -1);
                if (this.diskactive == 0) {
                    gccharacter::addpart(this.agni, "vl04/sash", 1);
                    this.diskactive = 1;
                }
            }
            
            //Set Tohunga: Tiribomba (VL05)
            gccharacter::settohunga(this.tiribomba, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk8a"));
            gccharacter::setorientation(this.tiribomba, 13);
            gccharacter::setinputstate(this.tiribomba, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.tiribomba, scslosifoundation::stringtoidentifier("hak6"), -1);
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl05"), 0), rgba(255, 247, 0, 255), rgba(255, 0, 13, 255), rgba(39, 39, 39, 255));
            
            //Set Tohunga: Aodhan (VL06)
            gccharacter::settohunga(this.aodhan, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mkca"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl06"), 0), rgba(255, 0, 13, 255), rgba(255, 247, 0, 255), rgba(39, 39, 39, 255));
            
            //Set Tohunga: Aft (VL07)
            gccharacter::settohunga(this.aft, rgba(39, 39, 39, 255), rgba(255, 92, 1, 255), scslosifoundation::stringtoidentifier("mk3a"));
            
            //Set Tohunga: Maglya (VL08)
            gccharacter::settohunga(this.maglya, rgba(255, 0, 13, 255), rgba(255, 0, 13, 255), scslosifoundation::stringtoidentifier("mk2a"));
            gccharacter::setorientation(this.maglya, -147);
            gccharacter::setinputstate(this.maglya, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.maglya, scslosifoundation::stringtoidentifier("d003"), -1);
            if (bettersaver::getbooleanvalue(49) == 1) {
                //Set to idle & place item
                gccharacter::switchanimation(this.maglya, scslosifoundation::stringtoidentifier("d000"), -1);
                if (this.boardactive == 2) {
                    this.hutboard.show();
                }
            }
            
            //Set Tohunga: Jala (VL09)
            gccharacter::settohunga(this.jala, rgba(255, 247, 0, 255), rgba(255, 247, 0, 255), scslosifoundation::stringtoidentifier("mk6a"));
            gccharacter::setorientation(this.jala, -29);
            gccharacter::setinputstate(this.jala, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.jala, scslosifoundation::stringtoidentifier("d000"), -1);
            
            //Set Tohunga: Treekeeper (VL10)
            gccharacter::settohunga(this.keeper, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk4a"));
            gccharacter::setorientation(this.keeper, -42);
            gccharacter::setinputstate(this.keeper, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.keeper, scslosifoundation::stringtoidentifier("d000"), -1);
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl10"), 0), rgba(0, 208, 33, 255), rgba(0, 208, 33, 255), rgba(102, 0, 102, 255));
            
            //Set Tohunga: Nganiki (VL11)
            gccharacter::settohunga(this.nganiki, rgba(255, 247, 0, 255), rgba(255, 247, 0, 255), scslosifoundation::stringtoidentifier("mkaa"));
            gccharacter::setorientation(this.nganiki, 100);
            gccharacter::setinputstate(this.nganiki, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.nganiki, scslosifoundation::stringtoidentifier("d000"), -1);
            gccharacter::addpart(this.nganiki, "vl11/pfrk", 1);
            gccharacter::addpart(this.nganiki, "vl11/shld", 2);
            
            //Set Tohunga: Klatuu (Vl12)
            gccharacter::settohunga(this.klatuu, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk7a"));
            gccharacter::setorientation(this.klatuu, -179);
            gccharacter::setinputstate(this.klatuu, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.klatuu, scslosifoundation::stringtoidentifier("d000"), -1);
            gccharacter::addpart(this.klatuu, "vl12/pfrk", 1);
            gccharacter::addpart(this.klatuu, "vl12/shld", 2);
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl12"), 0), rgba(255, 0, 13, 255), rgba(255, 0, 13, 255), rgba(255, 247, 0, 255));
            
            //Set Tohunga: Poiri (VL13)
            gccharacter::settohunga(this.poiri, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk0a"));
            gccharacter::setorientation(this.poiri, -7);
            gccharacter::setinputstate(this.poiri, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.poiri, scslosifoundation::stringtoidentifier("hak6"), -1);
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl13"), 0), rgba(39, 39, 39, 255), rgba(255, 0, 13, 255), rgba(255, 92, 1, 255));
            
            //Set Tohunga: Penpuku (VL14)
            gccharacter::settohunga(this.penpuku, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk1a"));
            gccharacter::setorientation(this.penpuku, -7);
            gccharacter::setinputstate(this.penpuku, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.penpuku, scslosifoundation::stringtoidentifier("hak6"), -1);
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl14"), 0), rgba(255, 0, 13, 255), rgba(255, 247, 0, 255), rgba(39, 39, 39, 255));
            
            //Set Tohunga: Giegue (VL15)
            gccharacter::settohunga(this.giegue, rgba(255, 0, 13, 255), rgba(39, 39, 39, 0), scslosifoundation::stringtoidentifier("mk6a"));
            gccharacter::setorientation(this.giegue, -7);
            gccharacter::setinputstate(this.giegue, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.giegue, scslosifoundation::stringtoidentifier("hak6"), -1);
            
            //Set Tohunga: Saumana (VL16)
            gccharacter::settohunga(this.saumana, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk4a"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl16"), 0), rgba(39, 39, 39, 255), rgba(255, 247, 0, 255), rgba(39, 39, 39, 255));
            
            //Set Tohunga: Joel (VL17)
            gccharacter::settohunga(this.joel, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mkba"));
            gccharacter::setcolors(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl17"), 0), rgba(255, 247, 0, 255), rgba(255, 247, 0, 255), rgba(255, 247, 0, 255));

            //Set Rahi: Blue Fly
			gcmodeldirector::show(scslosifoundation::stringtoidentifier("bfly"), 0);
            gccharacter::setgroundoffset(gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("bfly")), 2);

            //Hiding hives & Turaga door
            gcareadirector::hide(scslosifoundation::stringtoidentifier("fhv0"), gcareadirector::getcurrentarea());
            gcareadirector::hide(scslosifoundation::stringtoidentifier("fhv1"), gcareadirector::getcurrentarea());
            gcareadirector::hide(scslosifoundation::stringtoidentifier("fhv2"), gcareadirector::getcurrentarea());
            gcareadirector::hide(scslosifoundation::stringtoidentifier("fhv3"), gcareadirector::getcurrentarea());
            gcareadirector::hide(scslosifoundation::stringtoidentifier("door"), gcareadirector::getcurrentarea());
            globalclass.bgmusic.changefilename("Root/Data/sounds/MusicVillage");
            globalclass.bgmusic.play(1);
        }
        else {
            //Hiding Characters
            globalclass.player.processequipment(1);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vlgr"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl01"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl02"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl03"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl04"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl05"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl06"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl07"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl08"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl09"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl10"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl11"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl12"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl13"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl14"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl15"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl16"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl17"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("bfly"), 0);
            globalclass.bgmusic.changefilename("Root/Data/sounds/MUSICtahuTheme");
            globalclass.bgmusic.play(1);
        }
        this.upgradefruit2_shown = gcsaver::finditem(scslosifoundation::stringtoidentifier("fru0"));
        if (this.upgradefruit2_shown == 0) {
            this.upgradefruit2 = new lego_pickup("fru0", 0, 6, "frut", 1, 1);
            this.upgradefruit2.initfull();
        }
        this.upgradefruit3_shown = gcsaver::finditem(scslosifoundation::stringtoidentifier("fru1"));
        if (this.upgradefruit3_shown == 0) {
            this.upgradefruit3 = new lego_pickup("fru1", 0, 6, "frut", 1, 1);
            this.upgradefruit3.initfull();
        }
        if (bettersaver::getbooleanvalue(63)) {
            gccollisionphysicsgroup::togglepickuponoff(scslosifoundation::stringtoidentifier("ar00"), 0);
            gcnolightdirector::hide(scslosifoundation::stringtoidentifier("ar00"), gcareadirector::getcurrentarea());
        }
        this.wirlpool = new lego_moveableobject("vtcr");
        this.wirlpool.initfull();
        this.wirlpool.settweakable();
        this.orientation = 1;
        return null;
    }
    
    method cleanupfull() {
        if (this.swrd != null) {
            this.swrd.cleanupfull();
            this.swrd = null;
        }
        if (this.upgradefruit2 != null) {
            this.upgradefruit2.cleanupfull();
            this.upgradefruit2 = null;
        }
        if (this.upgradefruit3 != null) {
            this.upgradefruit3.cleanupfull();
            this.upgradefruit3 = null;
        }
        if (this.wirlpool != null) {
            this.wirlpool.cleanupfull();
            this.wirlpool = null;
        }
        this.kapura = null;
        this.keahi = null;
        this.vohon = null;
        this.nuri = null;
        this.agni = null;
        this.tiribomba = null;
        this.aodhan = null;
        this.aft = null;
        this.maglya = null;
        this.jala = null;
        this.keeper = null;
        this.nganiki = null;
        this.klatuu = null;
        this.poiri = null;
        this.penpuku = null;
        this.giegue = null;
        this.saumana = null;
        this.joel = null;
        this.boardactive = null;
        this.diskactive = null;
        this.hutboard = null;
        this.board = null;
        return null;
    }
    
    method exit() {
        this.parent = null;
        return null;
    }
    
    method process(param1) {
        this.rotatecrystal();
        return null;
    }
    
    method onevent(param1) {
        if (param1.eventid == 51) {
            this.deadhives = this.deadhives + 1;
        }
        else if (param1.eventid == 101) {
            this.savedrahi = this.savedrahi + 1;
        }        
        else if (param1.eventid == 44) {
            if ((this.deadhives == 4) && (this.savedrahi == 4) && (this.taskcomplete == 0)) {
                gcsaver::setcondition(1073741824, 1);
                gcareadirector::hide(scslosifoundation::stringtoidentifier("door"), scslosifoundation::stringtoidentifier("vllg"));
                globalclass.bgmusic.stop();
                this.taskcomplete = 1;
            }
        }
        else if (param1.eventid == 46) {
            gccollisionphysicsgroup::spinmask(1.2);
        }
        else if (param1.eventid == 27) {
            globalclass.level.cam.setaimode(11);
            globalclass.player.actor.gotopos(this.parent.enterstartid, this.parent.enterlookid);
            globalclass.player.unkill();
            globalclass.player.actor.switchanimation(scslosifoundation::stringtoidentifier("t000"));
            globalclass.player.actor.setinputstate("ninp");
        }
        else if (param1.eventid == 41) {
            if (bettersaver::getbooleanvalue(48)) {
                //Agni Quest Complete
                if (this.upgradefruit2_shown == 0) {
                    this.upgradefruit2.obj.setpos(-77.66334, 1.173774, 9.055604);
                    gcstaticsoundsptrarray::playtablesound(1032);
                    this.upgradefruit2_shown = 1;
                }
                if (this.diskactive == 0) {
                    gccharacter::addpart(this.agni, "vl04/sash", 1);
                    this.diskactive = 1;
                }
            }
            if (bettersaver::getbooleanvalue(49)) {
                //Maglya Quest Complete
                if (this.upgradefruit3_shown == 0) {
                    this.upgradefruit3.obj.setpos(-127.735626, -3.61725, 125.51088);
                    gcstaticsoundsptrarray::playtablesound(1032);
                    this.upgradefruit3_shown = 1;
                }
                if (this.boardactive == 0) {
                    this.board.show();
                    this.boardactive = 1;  
                }
            }
        }
        return null;
    }
    
    method input(param1) {
        return null;
    }
    
    method rotatecrystal() {
        if (this.orientation > 359) {
            this.orientation = 0;
        }
        else {
            this.orientation = this.orientation + 1;
        }
        this.wirlpool.setorientation(0.0, this.orientation, 0.0);
        return null;
    }
}