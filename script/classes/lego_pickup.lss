class lego_pickup {
    property obj;
    property rotation;
    property eventlistindex;
    property processlistindex;
    property scriptid;
    property putype;
    property objshown;
    property desctext;
    property deltatimer;
    property spinspeed;
    property howtotextarray;
    property condition;
    property quest;
    property water_pickup;
    property texttimer;
    
    method lego_pickup(objid, scriptid, pickuptype, stringtablegroup, groupid, numberofstrings) {
        var string;
        var var1;
        this.obj = new lego_moveableobject(objid);
        this.scriptid = scriptid;
        if (pickuptype == null) {
            this.putype = 0;
        }
        else {
            this.putype = pickuptype;
        }
        if (stringtablegroup == null) {
            string = " X X X ";
        }
        else {
            string = gcareadirector::getscriptstring(scslosifoundation::stringtoidentifier(stringtablegroup), groupid, 0);
        }
        this.desctext = new gs_legotext("Root/Data/Art/Fonts/BionicleFontHi", string, screenx * 0.5, screeny - 130, 0, 1.2, 256, 0, 0);
        this.howtotextarray = [  ];
        if (numberofstrings > 0) {
            var1 = 0;
            while ((numberofstrings - 1) >= var1) {
                if (stringtablegroup != null) {
                    string = gcareadirector::getscriptstring(scslosifoundation::stringtoidentifier(stringtablegroup), groupid, var1 + 1);
                }
                else {
                    string = "Text not localized yet...";
                }
                this.howtotextarray.__append(new gs_legotext("Root/Data/Art/Fonts/BionicleFont", string, screenx * 0.5, (screeny - 100) + (20 * var1), 0, 1.0, 256, 0, 0));
                var1 = var1 + 1;
            }
        }
        this.objshown = 1;
        this.water_pickup = 0;
        return null;
    }
    
    method initfull() {
        var var1;
        if (this.objshown) {
            this.obj.initfull();
            this.obj.setresponse(4, 4, 4);
            this.obj.changemainsystem(2);
            this.eventlistindex = globalclass.addtoeventlist(this);
            this.processlistindex = globalclass.addtoprocesslist(this);
            this.rotation = 0;
            this.desctext.initfull();
            this.deltatimer = 0.0;
            this.spinspeed = 10;
            var1 = 0;
            while ((this.howtotextarray.__length - 1) >= var1) {
                this.howtotextarray[var1].initfull();
                var1 = var1 + 1;
            }
            gclightdirector::setpickuplighting(this.obj.id);
            this.condition = 0;
            this.quest = 0;
            this.texttimer = 0.0;
        }
        return null;
    }
    
    method cleanupfull() {
        var var1;
        if (this.objshown) {
            globalclass.removefromeventlist(this.eventlistindex);
            globalclass.removefromprocesslist(this.processlistindex);
            gclightdirector::killpickuplighting(this.obj.id);
            this.objshown = 0;
        }
        if (this.obj != null) {
            this.obj.cleanupfull();
            this.obj = null;
        }
        if (this.desctext != null) {
            this.desctext.hide();
            this.desctext.cleanupfull();
            this.desctext = null;
        }
        this.deltatimer = null;
        if (this.howtotextarray != null) {
            var1 = 0;
            while ((this.howtotextarray.__length - 1) >= var1) {
                this.howtotextarray[var1].hide();
                this.howtotextarray[var1].cleanupfull();
                this.howtotextarray[var1] = null;
                var1 = var1 + 1;
            }
            this.howtotextarray = null;
        }
        this.scriptid = null;
        this.putype = null;
        this.water_pickup = null;
        this.texttimer = null;
        return null;
    }
    
    method show() {
        if (this.objshown == 1) {
            this.obj.show();
        }
        return null;
    }
    
    method hide() {
        if (this.objshown == 1) {
            this.obj.hide();
        }
        return null;
    }
    
    method remove() {
        if (this.objshown == 1) {
            this.obj.remove();
        }
        return null;
    }
    
    method setcondition(param1) {
        this.condition = param1;
        return null;
    }
    
    method setquest(param1) {
        this.quest = param1;
        return null;
    }
    
    method onevent(param1) {
        var var1;
        if (this.objshown == 1) {
            if (param1.eventid == 1) {
                if ((param1.args[0] == scslosifoundation::stringtoidentifier("cnt1")) && (param1.args[1] == this.obj.id)) {
                    if (this.putype == 1) {
                        gcstaticsoundsptrarray::playtablesound(1075);
                    }
                    if (this.putype == 2) {
                        gcstaticsoundsptrarray::playtablesound(1075);                        
                    }
                    if (this.putype == 3) {
                        gcstaticsoundsptrarray::playtablesound(1075);
                    }
                    if (this.putype == 4) {
                        gcstaticsoundsptrarray::playtablesound(1075);
                    }
                    if (this.putype == 5) {
                        gcstaticsoundsptrarray::playtablesound(1075);
                    }
                    if (this.putype == 6) {
                        gcstaticsoundsptrarray::playtablesound(1075);
                    }
                    if (this.putype == 7) {
                        gcstaticsoundsptrarray::playtablesound(1075);
                    }
                    this.pickup();
                    this.gotit();
                }
            }
            else if (param1.eventid == 39) {
                if (param1.args[0] == this.obj.id) {
                    this.objshown = 0;
                    gclightdirector::killpickuplighting(this.obj.id);
                    this.obj.hide();
                    this.desctext.hide();
                    var1 = 0;
                    while ((this.howtotextarray.__length - 1) >= var1) {
                        this.howtotextarray[var1].hide();
                        var1 = var1 + 1;
                    }
                }
                // reenable player input now that the pickup collection is finished
                globalclass.player.actor.setinputstate("ninp");
            }
        }
        return null;
    }
    
    method process(param1) {
        var var1;
        if (this.objshown == 1) {
            this.deltatimer = this.deltatimer + param1.deltatime;
            if (this.deltatimer > (1 / this.spinspeed)) {
                
            }
            if (this.rotation >= 360) {
                this.rotation = 0;
            }
            else {
                this.rotation = this.rotation + 2;
            }
            this.obj.setorientation(this.rotation, this.rotation, 0);
        }

        // if pickup is underwater, simulate the length of the collection animation with a timer
        if ((this.water_pickup == 1) && (this.texttimer != null)) {
            this.texttimer = this.texttimer + param1.deltatime;
            gclightdirector::killpickuplighting(this.obj.id);
            this.obj.hide();
            if (this.texttimer >= 5) {
                this.desctext.hide();
                var1 = 0;
                while ((this.howtotextarray.__length - 1) >= var1) {
                    this.howtotextarray[var1].hide();
                    var1 = var1 + 1;
                }
                this.water_pickup = 0;
            }
        }
        return null;
    }
    
    method pickup() {
        var var1;
        if (this.objshown == 1) {
            this.obj.disablecollisions();

            // is the pickup underwater or not?
            if (globalclass.player.submerged == 0) {
                // not underwater, proceed normally
                globalclass.player.actor.pickup(this.obj.id);
                // disable player input to stop grapple from firing, etc.  does not work for conversations due to hardcoding                
                globalclass.player.actor.setinputstate("none");
            }
            else {
                // underwater
                this.water_pickup = 1;
            }
            this.desctext.add();
            this.desctext.show();
            var1 = 0;
            while ((this.howtotextarray.__length - 1) >= var1) {
                this.howtotextarray[var1].add();
                this.howtotextarray[var1].show();
                var1 = var1 + 1;
            }
        }
        return null;
    }
    
    method settweakable() {
        if (this.objshown == 1) {
            this.obj.settweakable();
        }
        return null;
    }
    
    method interpolate(param1, param2, param3, param4) {
        if (this.objshown == 1) {
            this.obj.interpolate(param1, param2, param3, param4);
        }
        return null;
    }
    
    method gotit() {
        if (this.objshown == 1) {
            if (this.putype == 1) {
                globalclass.player.addmask("fake", this.scriptid);
                globalclass.hud.show();
                gcsaver::pickupmask(this.obj.id);
            }
            if (this.putype == 2) {
                globalclass.player.addelement(this.scriptid);
                globalclass.hud.show();
                gcsaver::pickupglyph(this.obj.id);
                gcsaver::setglyphfound();
            }
            if (this.putype == 3) {
                globalclass.player.setupgrapplinghook();
                gcsaver::pickupitem(this.obj.id);
                gcsaver::sethookfound();
            }
            if (this.putype == 4) {
                gcsaver::pickupitem(this.obj.id);
            }
            if (this.putype == 5) {
                gcsaver::pickupitem(this.obj.id);
                gcsaver::setcondition(this.condition, 1);
                if (globalclass.level.name == "lev1") {
                    gcsaver::setquest(1, this.quest);
                }
                else if (globalclass.level.name == "lev2") {
                    gcsaver::setquest(2, this.quest);
                }
                else if (globalclass.level.name == "lev3") {
                    gcsaver::setquest(3, this.quest);
                }
                else if (globalclass.level.name == "lev4") {
                    gcsaver::setquest(4, this.quest);
                }
                else if (globalclass.level.name == "lev5") {
                    gcsaver::setquest(5, this.quest);
                }
                else if (globalclass.level.name == "lev6") {
                    gcsaver::setquest(6, this.quest);
                }
            }
            if (this.putype == 6) {
                gcsaver::pickupitem(this.obj.id);
                globalclass.player.addmaxlife(20);
                gcsaver::sethealth(gcsaver::gethealth() + 20);
                globalclass.player.addmaxenergy(20);
                gcsaver::setenergy(gcsaver::getenergy() + 20);
            }
            if (this.putype == 7) {
                gcsaver::pickupitem(this.obj.id);
                if (globalclass.level.name == "lev1") {
                    globalclass.unlockdirector.unlocks.printonua = true;
                }
                else if (globalclass.level.name == "lev2") {
                    globalclass.unlockdirector.unlocks.printgali = true;
                }
                else if (globalclass.level.name == "lev3") {
                    globalclass.unlockdirector.unlocks.printpoha = true;
                }
                else if (globalclass.level.name == "lev4") {
                    globalclass.unlockdirector.unlocks.printkopa = true;
                }
                else if (globalclass.level.name == "lev5") {
                    globalclass.unlockdirector.unlocks.printlewa = true;
                }
                else if (globalclass.level.name == "lev6") {
                    globalclass.unlockdirector.unlocks.printtahu = true;
                }
                globalclass.unlockdirector.save();
            }
        }
        return null;
    }

    method fadein(param1) {
        if (this.objshown == 1) {
            this.obj.fadein(param1);
        }
        return null;
    }

    method fadeout(param1) {
        if (this.objshown == 1) {
            this.obj.fadeout(param1);
        }
        return null;
    }
}