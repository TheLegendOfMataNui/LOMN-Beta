class vllg1_puzzle {
    property parent;
    property cinema_intro;
    property cinema_intro_shown;
    property cinema_dance;
    property cinema_dance_shown;
    property deadhives;
    property savedrahi;
    property taskcomplete;
    property coindoor;
    property coindoortext;
    property coindoortexttimer;
    property showcoindoor;
    property upgradefruit;
    property upgradefruit2;
    property upgradefruit3;
    property upgradefruit_shown;
    property upgradefruit2_shown;
    property upgradefruit3_shown;
    property crystal;
    property orientation;
    property zemya;
    property taipu;
    property nuparu;
    property mamru;
    property nobua;
    property midak;
    property tehuti;
    property azibo;
    property onepu;
    property akamu;
    property keeper;
    property damek;
    property kaj;
    property aiyetoro;
    property dosne;
    property chadea;
    property pickactive;
    property diskactive;
    property summon_blorpo_timer;

    method vllg1_puzzle(param1) {
        this.parent = param1;
        return null;
    }
    
    method initfull() {
        gcareadirector::setnearestmax(15);
        gcmodeldirector::setnearestmax(5);
        gcareadirector::setfog(-402183, 0 - 40.0, 0 - 1200.0, 0.05);
        gclightdirector::setcavelighting(1);
        this.zemya = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vlgr"), 0);
        this.taipu = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl01"), 0);
        this.nuparu = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl02"), 0);
        this.mamru = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl03"), 0);
        this.nobua = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl04"), 0);
        this.midak = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl05"), 0);
        this.tehuti = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl06"), 0);
        this.azibo = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl07"), 0);
        this.onepu = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl08"), 0);
        this.akamu = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl09"), 0);
        this.keeper = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl10"), 0);
        this.damek = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl11"), 0);
        this.kaj = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl12"), 0);
        this.aiyetoro = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl13"), 0);
        this.dosne =  gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl14"), 0);
        this.chadea = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl15"), 0);
        this.pickactive = 0;
        this.diskactive = 0;
        if (gcsaver::findcinema(scslosifoundation::stringtoidentifier("cin2"))) {
            this.cinema_intro_shown = 1;
        }
        else {
            this.cinema_intro_shown = 0;
        }
        if (this.cinema_intro_shown == 0) {
            gcareadirector::hide(scslosifoundation::stringtoidentifier("dor2"), 0);
            gcareadirector::hide(scslosifoundation::stringtoidentifier("fhvb"), 0);
            gcareadirector::hide(scslosifoundation::stringtoidentifier("ghb0"), 0);
            gcareadirector::hide(scslosifoundation::stringtoidentifier("ghb1"), 0);
            gcareadirector::hide(scslosifoundation::stringtoidentifier("ghb2"), 0);
            this.cinema_intro = gccinemaengine::create();
            gccinemaengine::load(this.cinema_intro, "cin2");
            gccinemaengine::setnextarea(this.cinema_intro, scslosifoundation::stringtoidentifier("tura"));
            gccinemaengine::play(this.cinema_intro);
        }
        if (gcsaver::findcinema(scslosifoundation::stringtoidentifier("cin3"))) {
            this.cinema_dance_shown = 1;
        }
        else {
            this.cinema_dance_shown = 0;
        }
        if ((this.cinema_dance_shown == 0) && (this.cinema_intro_shown == 1)) {
            this.cinema_dance = gccinemaengine::create();
            gccinemaengine::load(this.cinema_dance, "cin3");
            gccinemaengine::setnextarea(this.cinema_dance, scslosifoundation::stringtoidentifier("tura"));
        }
        this.deadhives = 0;
        this.savedrahi = 0;
        this.taskcomplete = 0;
        if (gcsaver::isconditionset(4194304) == 1) {
            //Set Tohunga: Zemya (VLGR)
            gccharacter::settohunga(this.zemya, rgba(41, 41, 41, 255), rgba(41, 41, 41, 255), scslosifoundation::stringtoidentifier("mk6a"));
            gccharacter::setinputstate(this.zemya, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.zemya, scslosifoundation::stringtoidentifier("hak1"), -1);
            
            //Set Tohunga: Taipu (VL01)
            gccharacter::settohunga(this.taipu, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk0a"));
            gccharacter::setcolors(this.taipu, rgba(41, 41, 41, 255), rgba(41, 41, 41, 255), rgba(173, 150, 99, 255));
            gccharacter::setinputstate(this.taipu, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.taipu, scslosifoundation::stringtoidentifier("d003"), -1);
            if (bettersaver::getbooleanvalue(32) == 1) {
                //Set to idle & add item
                gccharacter::switchanimation(this.taipu, scslosifoundation::stringtoidentifier("d000"), -1);
                if (this.pickactive == 0) {
                    gccharacter::addpart(this.taipu, "vl01/pick", 1);
                    this.pickactive = 1;
                }
            }
            
            //Set Tohunga: Nuparu (VL02)
            gccharacter::settohunga(this.nuparu, rgba(107, 107, 107, 255), rgba(231, 77, 0, 255), scslosifoundation::stringtoidentifier("mk0a"));
            gccharacter::setinputstate(this.nuparu, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.nuparu, scslosifoundation::stringtoidentifier("d003"), -1);
            if (bettersaver::getbooleanvalue(33) == 1) {
                //Set to idle & add item              
                gccharacter::switchanimation(this.nuparu, scslosifoundation::stringtoidentifier("d000"), -1);
                if (this.diskactive == 0) {
                    gccharacter::addpart(this.nuparu, "vl02/sash", 1);
                    this.diskactive = 1;
                }
            }
            
            //Set Tohunga: Mamru (VL03)
            gccharacter::settohunga(this.mamru, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mkca"));
            gccharacter::setcolors(this.mamru, rgba(41, 41, 41, 255), rgba(41, 41, 41, 255), rgba(173, 150, 99, 255));
            
            //Set Tohunga: Nobua (VL04)
            gccharacter::settohunga(this.nobua, rgba(102, 0, 102, 255), rgba(102, 0, 102, 255), scslosifoundation::stringtoidentifier("mk6a"));
            gccharacter::setinputstate(this.nobua, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.nobua, scslosifoundation::stringtoidentifier("hak1"), -1);

            //Set Tohunga: Midak (VL05)
            gccharacter::settohunga(this.midak, rgba(41, 41, 41, 255), rgba(41, 41, 41, 255), scslosifoundation::stringtoidentifier("mk0a"));
            gccharacter::setorientation(this.midak, 122);
            gccharacter::setinputstate(this.midak, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.midak, scslosifoundation::stringtoidentifier("d003"), -1);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("bbug"), 0);  
            if (bettersaver::getbooleanvalue(34) == 1) {
                //Set to idle & spawn bug               
                gccharacter::switchanimation(this.midak, scslosifoundation::stringtoidentifier("d000"), -1);
                gcmodeldirector::show(scslosifoundation::stringtoidentifier("bbug"), 0);
            }

            //Set Tohunga: Tehuti (VL06)
            gccharacter::settohunga(this.tehuti, rgba(41, 41, 41, 255), rgba(41, 41, 41, 255), scslosifoundation::stringtoidentifier("mk2a"));

            //Set Tohunga: Azibo (VL07)
            gccharacter::settohunga(this.azibo, rgba(107, 107, 107, 255), rgba(231, 77, 0, 255), scslosifoundation::stringtoidentifier("mkba"));

            //Set Tohunga: Onepu (VL08)
            gccharacter::settohunga(this.onepu, rgba(102, 0, 102, 255), rgba(102, 0, 102, 255), scslosifoundation::stringtoidentifier("mk0a"));
            gccharacter::setorientation(this.onepu, 80);
            gccharacter::setinputstate(this.onepu, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.onepu, scslosifoundation::stringtoidentifier("d000"), -1);

            //Set Tohunga: Akamu (VL09)
            gccharacter::settohunga(this.akamu, rgba(102, 0, 102, 255), rgba(102, 0, 102, 255), scslosifoundation::stringtoidentifier("mk9a"));
            gccharacter::setorientation(this.akamu, -171);
            gccharacter::setinputstate(this.akamu, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.akamu, scslosifoundation::stringtoidentifier("hak1"), -1);

            //Set Tohunga: Treekeeper (VL10)
            gccharacter::settohunga(this.keeper, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0), scslosifoundation::stringtoidentifier("mk4a"));
            gccharacter::setcolors(this.keeper, rgba(0, 194, 41, 255), rgba(0, 194, 41, 255), rgba(102, 0, 102, 255));
            gccharacter::setorientation(this.keeper, -85);
            gccharacter::setinputstate(this.keeper, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.keeper, scslosifoundation::stringtoidentifier("d000"), -1);

            //Set Tohunga: Damek (VL11)
            gccharacter::settohunga(this.damek, rgba(102, 0, 102, 255), rgba(102, 0, 102, 255), scslosifoundation::stringtoidentifier("mk4a"));
            gccharacter::addpart(this.damek, "vl11/sash", 1);
            gccharacter::addpart(this.damek, "vl11/lstf", 2);
            gccharacter::setorientation(this.damek, 66);
            gccharacter::setinputstate(this.damek, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.damek, scslosifoundation::stringtoidentifier("d000"), -1);

            //Set Tohunga: Kaj (VL12)
            gccharacter::settohunga(this.kaj, rgba(102, 0, 102, 255), rgba(102, 0, 102, 255), scslosifoundation::stringtoidentifier("mk7a"));
            gccharacter::addpart(this.kaj, "vl12/sash", 1);
            gccharacter::addpart(this.kaj, "vl12/lstf", 2);
            gccharacter::setorientation(this.kaj, 7);
            gccharacter::setinputstate(this.kaj, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.kaj, scslosifoundation::stringtoidentifier("d000"), -1);

            //Set Tohunga: Aiyetoro (VL13)
            gccharacter::settohunga(this.aiyetoro, rgba(41, 41, 41, 255), rgba(41, 41, 41, 255), scslosifoundation::stringtoidentifier("mk8a"));
            gccharacter::addpart(this.aiyetoro, "vl13/sash", 1);
            gccharacter::addpart(this.aiyetoro, "vl13/lstf", 2);
            gccharacter::setorientation(this.aiyetoro, 179);
            gccharacter::setinputstate(this.aiyetoro, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.aiyetoro, scslosifoundation::stringtoidentifier("d000"), -1);
            
            //Set Tohunga: Dosne (VL14)
            gccharacter::settohunga(this.dosne, rgba(0, 0, 0, 0), rgba(0, 0, 0, 255), scslosifoundation::stringtoidentifier("mkaa"));
            gccharacter::setcolors(this.dosne, rgba(107, 107, 107, 255), rgba(231, 77, 0, 255), rgba(173, 150, 99, 255));
            gccharacter::addpart(this.dosne, "vl14/sash", 1);
            gccharacter::addpart(this.dosne, "vl14/lstf", 2);
            gccharacter::setorientation(this.dosne, -122);
            gccharacter::setinputstate(this.dosne, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.dosne, scslosifoundation::stringtoidentifier("d000"), -1);
            
            //Set Tohunga: Chadea (VL15)
            gccharacter::settohunga(this.chadea, rgba(102, 0, 102, 255), rgba(102, 0, 102, 255), scslosifoundation::stringtoidentifier("mk1a"));
            gccharacter::addpart(this.chadea, "vl15/sash", 1);
            gccharacter::addpart(this.chadea, "vl15/lstf", 2);
            gccharacter::setorientation(this.chadea, -43);
            gccharacter::setinputstate(this.chadea, scslosifoundation::stringtoidentifier("none"));
            gccharacter::switchanimation(this.chadea, scslosifoundation::stringtoidentifier("d000"), -1);                                             
            
            //Hiding hives & Turaga door
            gcareadirector::hide(scslosifoundation::stringtoidentifier("dor2"), scslosifoundation::stringtoidentifier("vllg"));
            gcareadirector::hide(scslosifoundation::stringtoidentifier("ghv0"), scslosifoundation::stringtoidentifier("vllg"));
            gcareadirector::hide(scslosifoundation::stringtoidentifier("ghv1"), scslosifoundation::stringtoidentifier("vllg"));
            gcareadirector::hide(scslosifoundation::stringtoidentifier("ghv2"), scslosifoundation::stringtoidentifier("vllg"));
            gcareadirector::hide(scslosifoundation::stringtoidentifier("fhv0"), scslosifoundation::stringtoidentifier("vllg"));
            globalclass.bgmusic.changefilename("Root/Data/sounds/MusicVillage");
            globalclass.bgmusic.play(1);
        }
        else {
            //Hiding Characters and Waypoint
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("bbug"), 0);  
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vlgr"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl01"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl02"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl03"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl04"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl05"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl06"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl07"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl08"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl09"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl10"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl11"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl12"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl13"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl14"), 0);
            gcmodeldirector::hide(scslosifoundation::stringtoidentifier("vl15"), 0);
            gccollisionphysicsgroup::togglepickuponoff(scslosifoundation::stringtoidentifier("ar00"), 0);
            gcnolightdirector::hide(scslosifoundation::stringtoidentifier("ar00"), gcareadirector::getcurrentarea());
            if (bettersaver::getbooleanvalue(50) == 1) {
                globalclass.bgmusic.changefilename("Root/Data/sounds/MUSICONUATHEME");
                globalclass.bgmusic.play(1);
            }
        }
        this.coindoor = new lego_moveableobject("dr00", "vllg");
        this.coindoor.initfull();
        if (bettersaver::getbooleanvalue(52) == 0) {
            this.showcoindoor = 1;
            this.coindoor.show();
            this.coindoor.setalpha(0.5);
        }
        else {
            this.coindoor.hide();
        }
        this.coindoortext = new gs_legotext("Root/Data/Art/Fonts/BionicleFontHi", gcareadirector::getscriptfluffstring(scslosifoundation::stringtoidentifier("door"), 1, 0) + "10 " + gcareadirector::getscriptfluffstring(scslosifoundation::stringtoidentifier("door"), 1, 4), screenx * 0.5, screeny * 0.70, 0, 1.5, 256, 4, 0);
        this.coindoortext.initfull();
        this.coindoortext.add();
        this.coindoortexttimer = 0.0;
        this.upgradefruit_shown = gcsaver::finditem(scslosifoundation::stringtoidentifier("frut"));
        if (this.upgradefruit_shown == 0) {
            this.upgradefruit = new lego_pickup("frut", 0, 6, "frut", 1, 1);
            this.upgradefruit.initfull();
        }
        this.upgradefruit2_shown = gcsaver::finditem(scslosifoundation::stringtoidentifier("fru0"));
        if (this.upgradefruit2_shown == 0) {
            this.upgradefruit2 = new lego_pickup("fru0", 0, 6, "frut", 1, 1);
            this.upgradefruit2.initfull();
        }
        this.upgradefruit3_shown = gcsaver::finditem(scslosifoundation::stringtoidentifier("fru1"));
        if (this.upgradefruit3_shown == 0) {
            this.upgradefruit3 = new lego_pickup("fru1", 0, 6, "frut", 1, 1);
            this.upgradefruit3.initfull();
        }
        if (bettersaver::getbooleanvalue(58) == 1) {
            gccollisionphysicsgroup::togglepickuponoff(scslosifoundation::stringtoidentifier("ar00"), 0);
            gcnolightdirector::hide(scslosifoundation::stringtoidentifier("ar00"), gcareadirector::getcurrentarea());
        }
        else if ((bettersaver::getbooleanvalue(58) == 0) && (gcsaver::isconditionset(4194304) == 1)) {
            gccollisionphysicsgroup::togglepickuponoff(scslosifoundation::stringtoidentifier("ar00"), 1);
            gcnolightdirector::show(scslosifoundation::stringtoidentifier("ar00"), gcareadirector::getcurrentarea());
        }
        this.crystal = new lego_moveableobject("vtcr");
        this.crystal.initfull();
        this.crystal.settweakable();
        this.orientation = 1;
        this.summon_blorpo_timer = 37;
        return null;
    }
    
    method cleanupfull() {
        if (this.coindoortext != null) {
            this.coindoortext.remove();
            this.coindoortext.cleanupfull();
            this.coindoortext = null;
        }
        if (this.coindoor != null) {
            this.coindoor.cleanupfull();
            this.coindoor = null;
        }
        if (this.upgradefruit != null) {
            this.upgradefruit.cleanupfull();
            this.upgradefruit = null;
        }
        if (this.upgradefruit2 != null) {
            this.upgradefruit2.cleanupfull();
            this.upgradefruit2 = null;
        }
        if (this.upgradefruit3 != null) {
            this.upgradefruit3.cleanupfull();
            this.upgradefruit3 = null;
        }
        if (this.crystal != null) {
            this.crystal.cleanupfull();
            this.crystal = null;
        }
        this.deadhives = null;
        this.savedrahi = null;
        this.taskcomplete = null;
        this.showcoindoor = null;
        this.cinema_intro = null;
        this.cinema_intro_shown = null;
        this.cinema_dance = null;
        this.cinema_dance_shown = null;
        this.upgradefruit_shown = null;
        this.upgradefruit2_shown = null;
        this.upgradefruit3_shown = null;
        this.orientation = null;
        this.zemya = null;
        this.taipu = null;
        this.nuparu = null;
        this.mamru = null;
        this.nobua = null;
        this.midak = null;
        this.tehuti = null;
        this.azibo = null;
        this.onepu = null;
        this.akamu = null;
        this.keeper = null;
        this.damek = null;
        this.kaj = null;
        this.aiyetoro = null;
        this.dosne = null;
        this.chadea = null;
        this.pickactive = null;
        this.diskactive = null;
        this.summon_blorpo_timer = null;
        return null;
    }
    
    method process(param1) {
        this.rotatecrystal();
        if (this.coindoortexttimer > 0) {
            this.coindoortexttimer = this.coindoortexttimer - param1.deltatime;
        }
        else if (this.coindoortext.onscreen == 1) {
            this.coindoortext.hide();
        }
        if (bettersaver::getbooleanvalue(88) == 0) {
            if (this.summon_blorpo_timer > 0) {
                this.summon_blorpo_timer = this.summon_blorpo_timer - param1.deltatime;
            }
            if ((this.deadhives == 4) && (this.savedrahi == 4) && (this.summon_blorpo_timer > 0)) {
                bettersaver::setbooleanvalue(88, 1);
            }
        }
        return null;
    }
    
    method onevent(param1) {
        if (param1.eventid == 27) {
            globalclass.player.actor.gotopos(this.parent.enterstartid, this.parent.enterlookid);
            globalclass.player.unkill();
            globalclass.player.actor.setinputstate("ninp");
            this.parent.level.cam.setaimode(11);
            globalclass.player.actor.switchanimation(scslosifoundation::stringtoidentifier("o000"));
        }
        else if (param1.eventid == 51) {
            this.deadhives = this.deadhives + 1;
        }
        else if (param1.eventid == 101) {
            this.savedrahi = this.savedrahi + 1;
        }        
        else if (param1.eventid == 44) {
            if ((this.cinema_intro != null) && (this.cinema_intro_shown == 0)) {
                var tohunga;
                tohunga = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vlgr"), 0);
                gccharacter::settohunga(tohunga, rgba(102, 0, 102, 255), rgba(102, 0, 102, 255), scslosifoundation::stringtoidentifier("mk6a"));
                tohunga = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl01"), 0);
                gccharacter::settohunga(tohunga, rgba(102, 0, 102, 255), rgba(102, 0, 102, 255), scslosifoundation::stringtoidentifier("mk4a"));
                tohunga = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl02"), 0);
                gccharacter::settohunga(tohunga, rgba(41, 41, 41, 255), rgba(247, 105, 33, 255), scslosifoundation::stringtoidentifier("mkca"));
                tohunga = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl03"), 0);
                gccharacter::settohunga(tohunga, rgba(41, 41, 41, 255), rgba(41, 41, 41, 255), scslosifoundation::stringtoidentifier("mk0a"));
                tohunga = gcmodeldirector::getcharacter(scslosifoundation::stringtoidentifier("vl04"), 0);
                gccharacter::settohunga(tohunga, rgba(102, 0, 102, 255), rgba(102, 0, 102, 255), scslosifoundation::stringtoidentifier("mk2a"));
                gcmodeldirector::show(scslosifoundation::stringtoidentifier("vlgr"), 0);
                gcmodeldirector::show(scslosifoundation::stringtoidentifier("vl01"), 0);
                gcmodeldirector::show(scslosifoundation::stringtoidentifier("vl02"), 0);
                gcmodeldirector::show(scslosifoundation::stringtoidentifier("vl03"), 0);
                gcmodeldirector::show(scslosifoundation::stringtoidentifier("vl04"), 0);
            }
            if ((this.deadhives == 4) && (this.savedrahi == 4) && (this.taskcomplete == 0)) {
                gcsaver::setcondition(4194304, 1);
                gcareadirector::hide(scslosifoundation::stringtoidentifier("dor2"), scslosifoundation::stringtoidentifier("vllg"));
                gccollisionphysicsgroup::togglepickuponoff(scslosifoundation::stringtoidentifier("ar00"), 1);
                gcnolightdirector::show(scslosifoundation::stringtoidentifier("ar00"), gcareadirector::getcurrentarea());
                globalclass.bgmusic.stop();
                this.taskcomplete = 1;
            }
        }
        else if (param1.eventid == 35) {
            if (param1.args[0] == scslosifoundation::stringtoidentifier("dr00")) {
                bettersaver::setbooleanvalue(52, 1);
                this.coindoor.hide();
            }
        }
        else if (param1.eventid == 41) {
            if (bettersaver::getbooleanvalue(32)) {
                //Taipu Quest Complete
                if (this.upgradefruit_shown == 0) {
                    this.upgradefruit.obj.setpos(-241.3573, -51.5535, 739.7539);
                    gcstaticsoundsptrarray::playtablesound(1032);
                    this.upgradefruit_shown = 1;
                }               
                if (this.pickactive == 0) {
                    gccharacter::addpart(this.taipu, "vl01/pick", 1);
                    this.pickactive = 1;
                }
            }
            if (bettersaver::getbooleanvalue(33)) {
                //Nuparu Quest Complete                
                if (this.upgradefruit2_shown == 0) {
                    this.upgradefruit2.obj.setpos(-326.5602, -57.77215, 741.3592);
                    gcstaticsoundsptrarray::playtablesound(1032);
                    this.upgradefruit2_shown = 1;
                }   
                if (this.diskactive == 0) {
                    gccharacter::addpart(this.nuparu, "vl02/sash", 1);
                    this.diskactive = 1;
                }
            }
            if (bettersaver::getbooleanvalue(34)) {
                //Midak Quest Complete               
                if (this.upgradefruit3_shown == 0) {
                    this.upgradefruit3.obj.setpos(-393.5724, -57.77681, 859.7791);
                    gcstaticsoundsptrarray::playtablesound(1032);
                    this.upgradefruit3_shown = 1;
                }
                gcmodeldirector::show(scslosifoundation::stringtoidentifier("bbug"), 0);
            }
        }
        else if (param1.eventid == 4) {
            if ((param1.args[0] == scslosifoundation::stringtoidentifier("cin3")) && (this.cinema_dance_shown == 0)) {
                if (((gcsaver::isconditionset(1) && gcsaver::isconditionset(2)) && gcsaver::isconditionset(4)) && gcsaver::isconditionset(8)) {
                    globalclass.player.cinematic_start = 1;                
                    if (globalclass.player.cinematic_delay > 0.01) {
                        gccinemaengine::play(this.cinema_dance);
                        //Remove Tohunga hand items
                        if (bettersaver::getbooleanvalue(32) == 1) {
                            gccharacter::removepart(this.taipu, 1);
                        }
                        gccharacter::removepart(this.damek, 2);
                        gccharacter::removepart(this.kaj, 2);
                        gccharacter::removepart(this.aiyetoro, 2);
                        gccharacter::removepart(this.dosne, 2);
                        gccharacter::removepart(this.chadea, 2);
                        this.cinema_dance_shown = 1;
                        bettersaver::setbooleanvalue(82, 1);
                    }
                }
            }
        }
        else if (param1.eventid == 30) {
            this.parent.level.cam.setaimode(9);
            globalclass.hud.hide();
        }
        else if (param1.eventid == 1) {
            if (param1.args[0] == scslosifoundation::stringtoidentifier("cnt1")) {
                if (param1.args[1] == scslosifoundation::stringtoidentifier("dr00")) {
                    if (this.showcoindoor == 1) {
                        if ((globalclass.player.tokens >= 10) && (gcsaver::isconditionset(4194304))) {
                            this.coindoor.fadeout(1.5);
                            gcstaticsoundsptrarray::playtablesound(1084);
                            this.showcoindoor = 0;
                            this.coindoortext.hide();
                        }
                        else {
                            this.coindoortext.show();
                            this.coindoortexttimer = 1.0;
                        }
                    }
                }
            }
        }
        return null;
    }
    
    method input(param1) {
        if (param1.event == 2) {
            if (param1.button == 251) {
                if (this.cinema_intro != null) {
                    gccinemaengine::stop(this.cinema_intro);
                    globalclass.bgmusic.stop();
                }
                if (this.cinema_dance != null) {
                    gccinemaengine::stop(this.cinema_dance);
                    if (this.cinema_dance_shown == 1) {
                        globalclass.bgmusic.stop();
                    }
                }
            }
        }
        return null;
    }
    
    method exit() {
        this.parent = null;
        return null;
    }
    
    method rotatecrystal() {
        if (this.orientation > 359) {
            this.orientation = 0;
        }
        else {
            this.orientation = this.orientation + 1;
        }
        this.crystal.setorientation(0.0, this.orientation, 0.0);
        return null;
    }
}